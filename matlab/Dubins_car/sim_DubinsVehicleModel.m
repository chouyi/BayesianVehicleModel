%clear all
nt=500;
x= zeros(4,nt);
x(:,1)=[0;0;2;1.57];

h=0.5;
ti=1:nt;
t=(ti-1)*h;
w=0.2;
u_v=0.5*sin(w*t);
%u_v=zeros(nt,1);
% u_v(1:10)=0.1;
% u_v(11:20)=0.2;
% u_v(21:30)=0.3;
% u_v(31:50)=0.2;
% u_v(51:70)=0.2;
% u_v(71:85)=0.15;
% u_v(86:100)=0.05;
%u_v=0.5*ones(nt,1);
u_a=0.5*sin(w*t);
% u_a=zeros(nt,1);
% u_a(11:20)=-0.5;
% u_a(21:40)=-0.4;
% u_a(41:60)=-0.2;
% u_a(61:75)=0.2;
% u_a(76:100)=0.5;
% u_a=0.5*ones(nt,1);

%cov = (1/200)*[[3, 2, 1, 1];[2, 3, 2, 1];[1, 2, 3, 0.5];[1, 1, 0.5, 3]];
cov = (1/100)*[[3, 0.1, 1, 1];[0.1, 3, 2, 1];[1, 2, 3, 0.1];[1, 1, 0.1, 3]];
%cov = (1/3000)*[[3, 0.1, 1, 1];[0.1, 3, 2, 1];[1, 2, 3, 0.1];[1, 1, 0.1, 3]];
%cov = (1/1000)*[[1, 0, 0, 0];[0, 1, 0, 0];[0, 0, 0.2, 0.];[0, 0, 0., 0.2]];
for k=2:nt
    x(1,k)=x(1,k-1)+h*x(3,k-1)*cos(x(4,k-1))+(h^2/2)*u_v(k-1)*cos(x(4,k-1));
    x(2,k)=x(2,k-1)+h*x(3,k-1)*sin(x(4,k-1))+(h^2/2)*u_v(k-1)*sin(x(4,k-1));
    x(3,k)=x(3,k-1)+h*u_v(k-1);
    x(4,k)=x(4,k-1)+h*u_a(k-1);
    y(:,k)=x(:,k);
    x(:,k)=mvnrnd(x(:,k),cov)'; 
    
end
% for k=1:nt
%     y(:,k)=mvnrnd(x(:,k),cov);%x(:,k)+0.05*randn(4,1);
% end
%plot(x(1,:),x(2,:),y(1,:),y(2,:));
plot(x(1,:),x(2,:));
hold on
M=x';

% % %%%%%
% for k=1:nt-1
%     uv=(x(3,k+1)-x(3,k))/h;
%     ua=(x(4,k+1)-x(4,k))/h;
%     x1(1,k+1)=x(1,k)+h*x(3,k)*cos(x(4,k))+(h^2/2)*uv*cos(x(4,k));
%     x1(2,k+1)=x(2,k)+h*x(3,k)*sin(x(4,k))+(h^2/2)*uv*sin(x(4,k));
%     x1(3,k+1)=x(3,k)+h*uv;
%     x1(4,k+1)=x(4,k)+h*ua;
%     error(k,:)=x1(:,k+1)-x(:,k+1);
% end